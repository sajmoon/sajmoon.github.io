<!DOCTYPE html><html><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="preload" href="/component---src-layouts-index-js-4ff78f3b1d367737e2f8.js" as="script"/><link rel="preload" href="/component---src-templates-blog-post-js-8d09796dfb35ed252c2e.js" as="script"/><link rel="preload" href="/path---2016-2016-01-02-elixir-phoenix-simple-authentication-c9818ddd92b6f348f55a.js" as="script"/><link rel="preload" href="/app-ad382b1bccf1275c3dfd.js" as="script"/><link rel="preload" href="/commons-78727bd33a365b16d4bb.js" as="script"/><script id="webpack-manifest">/*<![CDATA[*/window.webpackManifest={"231608221292675":"app-ad382b1bccf1275c3dfd.js","99219681209289":"component---node-modules-gatsby-plugin-offline-app-shell-js-5c4c5a0f7af9dc69d6d7.js","107818501498521":"component---src-templates-blog-post-js-8d09796dfb35ed252c2e.js","162898551421021":"component---src-pages-404-js-2243362f27234f6cf611.js","35783957827783":"component---src-pages-index-js-b39a14dfd7f173932093.js","60335399758886":"path----557518bd178906f8d58a.js","210333531512890":"path---offline-plugin-app-shell-fallback-a0e39f21c11f6a62c5ab.js","25418589883649":"path---1970-1970-01-01-untitled-544db93048a3cdaeb16c.js","82145113734165":"path---1970-1970-01-01-elixir-play-a-game-with-phoenix-channels-d90438d6e6983a5c3ce5.js","197112875868447":"path---1970-1970-01-01-use-mock-in-elixir-55530a24a5a7fbdfedf0.js","265293670101394":"path---1970-1970-01-01-social-sharing-buttons-for-websites-57814aa4873556a69dba.js","179311003292518":"path---2015-2015-04-17-phoenix-ecto-on-heroku-2-ba828440e2560c67e2a9.js","5923604354466":"path---2015-2015-05-08-goolge-map-directive-angular-b1468d219a63ff5aca29.js","5588187674923":"path---2015-2015-04-21-elixir-testing-tag-tests-in-exunit-f631620180a76a5b51b1.js","82688832499862":"path---2015-2015-04-22-postfix-redirect-all-outgoing-mails-to-local-user-1ca202943269a514c436.js","219205991181765":"path---2015-2015-07-14-change-file-encoding-in-the-terminal-8e73db2cf6131f5789df.js","199990424965975":"path---2015-2015-07-22-setup-logging-in-jboss-with-jboss-cli-286509f8cee088221e06.js","198815778794485":"path---2015-2015-08-28-react-with-bourbon-2-4692f4a2c7e0b02e9953.js","47105768037807":"path---2015-2015-07-30-setting-up-a-s-3-bucket-for-fileupload-69db51e9065d2c86731b.js","59577248741097":"path---2015-2015-09-16-start-from-scratch-with-reactredux-1d2ef1f379890126a207.js","65475824467994":"path---2015-2015-09-29-build-bomberman-game-in-elm-c74610fe77f4b1e97078.js","82275407414035":"path---2015-2015-10-25-elixir-a-simple-server-with-plug-8c4aad950661225db441.js","244327035869138":"path---2015-2015-09-29-start-from-zero-with-elm-82d5b704b00321d35325.js","153959489979572":"path---2015-2015-11-08-angular-caching-of-data-in-services-18d891b3a0b56f8ec852.js","138779859493271":"path---2015-2015-10-25-playing-around-with-elixir-processes-380800d934ee66e71228.js","159223139350163":"path---2016-2016-05-16-w-f1ca1eab49b4a6a2a7f6.js","275924165586894":"path---2016-2016-01-02-elixir-phoenix-simple-authentication-c9818ddd92b6f348f55a.js","281168960243606":"path---2016-2016-07-22-grouping-tests-with-exunit-elixir-408860c64b53d5e7a5d8.js","25440093797002":"path---2016-2016-10-22-tag-tests-that-uses-network-exunit-2-9b0650dbcd5a11af4e68.js","155160695504307":"path---2016-2016-10-19-working-with-ecto-in-tests-a18b0dc06c8574a71913.js","94804929006867":"path---2016-2016-12-04-deploy-to-kubernetes-running-on-google-container-engine-0daf72348dd69d7d7c05.js","152895276810123":"path---2018-hello-world-3e6595ecc6413de38f90.js","212758512388338":"path---2018-ruby-add-methods-to-classes-088b447514f1799ae7cd.js","178972477477218":"path---2018-starting-resources-for-ios-and-swift-700b8e945e779694ddbd.js","226288799040597":"path---2017-swift-language-feature-summary-f8e46aaf443af5944a65.js","61059119300957":"path---2018-gatsby-add-drafts-d9a816ba077dd33762eb.js","109462570138001":"path---2018-ios-testing-f26bb97947e9126de0c5.js","210585330587240":"path---2018-universal-and-app-links-703af2223964a3aa83bd.js","254022195166212":"path---404-a0e39f21c11f6a62c5ab.js","142629428675168":"path---index-c742483c944dc79c8878.js","178698757827068":"path---404-html-a0e39f21c11f6a62c5ab.js","114276838955818":"component---src-layouts-index-js-4ff78f3b1d367737e2f8.js"}/*]]>*/</script><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><title data-react-helmet="true">Elixir - Phoenix: Simple Authentication | Tinkering with Code.</title><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.56em 'Source Sans Pro',sans-serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.7);font-family:'Source Sans Pro',sans-serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.56rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.56rem;color:hsla(0,0%,0%,0.85);font-family:'Source Sans Pro',sans-serif;font-weight:200;text-rendering:optimizeLegibility;font-size:2.5rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.56rem;color:hsla(0,0%,0%,0.85);font-family:'Source Sans Pro',sans-serif;font-weight:200;text-rendering:optimizeLegibility;font-size:1.73286rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.56rem;color:hsla(0,0%,0%,0.85);font-family:'Source Sans Pro',sans-serif;font-weight:200;text-rendering:optimizeLegibility;font-size:1.4427rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.56rem;color:hsla(0,0%,0%,0.85);font-family:'Source Sans Pro',sans-serif;font-weight:200;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.56rem;color:hsla(0,0%,0%,0.85);font-family:'Source Sans Pro',sans-serif;font-weight:200;text-rendering:optimizeLegibility;font-size:0.83255rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.56rem;color:hsla(0,0%,0%,0.85);font-family:'Source Sans Pro',sans-serif;font-weight:200;text-rendering:optimizeLegibility;font-size:0.75966rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.56rem;}ul{margin-left:1.56rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.56rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.56rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.56rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.56rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.56rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.56rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.56rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.56rem;font-size:0.85rem;line-height:1.56rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.56rem;font-size:1rem;line-height:1.56rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.56rem;}blockquote{margin-left:0;margin-right:1.56rem;margin-top:0;padding-bottom:0;padding-left:1.17rem;padding-right:0;padding-top:0;margin-bottom:1.56rem;font-size:1.20112rem;line-height:1.56rem;color:hsla(0,0%,0%,0.6);border-left:0.39rem solid hsla(0,0%,0%,0.13);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.56rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.56rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.56rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.56rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.56rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.56rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.56rem;margin-bottom:calc(1.56rem / 2);margin-top:calc(1.56rem / 2);}li > ul{margin-left:1.56rem;margin-bottom:calc(1.56rem / 2);margin-top:calc(1.56rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.56rem / 2);}code{font-size:0.85rem;line-height:1.56rem;}kbd{font-size:0.85rem;line-height:1.56rem;}samp{font-size:0.85rem;line-height:1.56rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.04rem;padding-right:1.04rem;padding-top:0.78rem;padding-bottom:calc(0.78rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}h1 a,h2 a,h3 a,h4 a,h5 a,h6 a{font-weight:200;}a{font-weight:400;color:#419eda;text-decoration:none;}a:hover{color:#2a6496;text-decoration:underline;}@media only screen and (max-width:768px){html{font-size:100%;line-height:1.555em;}blockquote{margin-left:-1.17rem;margin-right:0;padding-left:0.78rem;}table{font-size:0.83255rem;line-height:1.56rem;}}</style><link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:200,400,400i,700" rel="stylesheet" type="text/css"/><link rel="manifest" href="/favicons/manifest.json"/><link rel="apple-touch-icon" sizes="57x57" href="/favicons/apple-touch-icon-57x57.png"/><link rel="apple-touch-icon" sizes="60x60" href="/favicons/apple-touch-icon-60x60.png"/><link rel="apple-touch-icon" sizes="72x72" href="/favicons/apple-touch-icon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/favicons/apple-touch-icon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/favicons/apple-touch-icon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/favicons/apple-touch-icon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/favicons/apple-touch-icon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/favicons/apple-touch-icon-152x152.png"/><link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon-180x180.png"/><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 1)" href="/favicons/apple-touch-startup-image-320x460.png"/><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 480px) and (-webkit-device-pixel-ratio: 2)" href="/favicons/apple-touch-startup-image-640x920.png"/><link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)" href="/favicons/apple-touch-startup-image-640x1096.png"/><link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)" href="/favicons/apple-touch-startup-image-750x1294.png"/><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 3)" href="/favicons/apple-touch-startup-image-1182x2208.png"/><link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 3)" href="/favicons/apple-touch-startup-image-1242x2148.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 1)" href="/favicons/apple-touch-startup-image-748x1024.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 1)" href="/favicons/apple-touch-startup-image-768x1004.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: landscape) and (-webkit-device-pixel-ratio: 2)" href="/favicons/apple-touch-startup-image-1496x2048.png"/><link rel="apple-touch-startup-image" media="(device-width: 768px) and (device-height: 1024px) and (orientation: portrait) and (-webkit-device-pixel-ratio: 2)" href="/favicons/apple-touch-startup-image-1536x2008.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png"/><link rel="shortcut icon" href="/favicons/favicon.ico"/><script>/*<![CDATA[*/!function(e,t,r){function n(){for(;d[0]&&"loaded"==d[0][f];)c=d.shift(),c[o]=!i.parentNode.insertBefore(c,i)}for(var s,a,c,d=[],i=e.scripts[0],o="onreadystatechange",f="readyState";s=r.shift();)a=e.createElement(t),"async"in i?(a.async=!1,e.head.appendChild(a)):i[f]?(d.push(a),a[o]=n):e.write("<"+t+' src="'+s+'" defer></'+t+">"),a.src=s}(document,"script",["/commons-78727bd33a365b16d4bb.js","/app-ad382b1bccf1275c3dfd.js","/path---2016-2016-01-02-elixir-phoenix-simple-authentication-c9818ddd92b6f348f55a.js","/component---src-templates-blog-post-js-8d09796dfb35ed252c2e.js","/component---src-layouts-index-js-4ff78f3b1d367737e2f8.js"])/*]]>*/</script><style id="gatsby-inlined-css">code[class*=language-],pre[class*=language-]{color:#657b83;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{background:#073642}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#073642}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdf6e3}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#586e75}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#268bd2}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:#2aa198}.token.entity{color:#657b83;background:#eee8d5}.token.atrule,.token.attr-value,.token.keyword{color:#859900}.token.function{color:#b58900}.token.important,.token.regex,.token.variable{color:#cb4b16}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100.50d27986.woff2) format("woff2"),url(/static/montserrat-latin-100.5e334eff.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic.8c070533.woff2) format("woff2"),url(/static/montserrat-latin-100italic.03e19243.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200.4343d3d9.woff2) format("woff2"),url(/static/montserrat-latin-200.f2022ecd.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic.116c4c4b.woff2) format("woff2"),url(/static/montserrat-latin-200italic.89614a60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300.d2ad295b.woff2) format("woff2"),url(/static/montserrat-latin-300.3a371ee0.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic.f6b6bf24.woff2) format("woff2"),url(/static/montserrat-latin-300italic.16521668.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400.240a8444.woff2) format("woff2"),url(/static/montserrat-latin-400.b20cc131.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic.86172bb8.woff2) format("woff2"),url(/static/montserrat-latin-400italic.9405e787.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500.fb8d6b71.woff2) format("woff2"),url(/static/montserrat-latin-500.50825d47.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic.c0a555a4.woff2) format("woff2"),url(/static/montserrat-latin-500italic.635de59c.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600.d5615136.woff2) format("woff2"),url(/static/montserrat-latin-600.f300da4f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic.10f29d13.woff2) format("woff2"),url(/static/montserrat-latin-600italic.2bc37d86.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700.7d77e1f0.woff2) format("woff2"),url(/static/montserrat-latin-700.81826529.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic.1dd2b53f.woff2) format("woff2"),url(/static/montserrat-latin-700italic.c162d257.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800.d4e7bf86.woff2) format("woff2"),url(/static/montserrat-latin-800.895aadbf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic.fc0cbe44.woff2) format("woff2"),url(/static/montserrat-latin-800italic.b3362875.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900.c8bdd772.woff2) format("woff2"),url(/static/montserrat-latin-900.1b99ef78.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic.cb72c1f9.woff2) format("woff2"),url(/static/montserrat-latin-900italic.b78bb9f8.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300.f015f1e9.woff2) format("woff2"),url(/static/merriweather-latin-300.92dfe81b.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic.7fd86b32.woff2) format("woff2"),url(/static/merriweather-latin-300italic.878b76f5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400.12dbf4c0.woff2) format("woff2"),url(/static/merriweather-latin-400.1fffad22.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic.1e0d3e81.woff2) format("woff2"),url(/static/merriweather-latin-400italic.de18d4c4.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700.dc8fec81.woff2) format("woff2"),url(/static/merriweather-latin-700.d7d2ed8e.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic.b7b7e5da.woff2) format("woff2"),url(/static/merriweather-latin-700italic.6210a5fc.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900.43f870d5.woff2) format("woff2"),url(/static/merriweather-latin-900.8f3806df.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic.168c1ab2.woff2) format("woff2"),url(/static/merriweather-latin-900italic.ae7778f0.woff) format("woff")}</style></head><body><div id="___gatsby"><div style="max-width:37.44rem;margin-left:auto;margin-right:auto;padding:2.34rem 1.17rem;" data-reactroot="" data-reactid="1" data-react-checksum="1566606024"><h3 style="font-family:Montserrat, sans-serif;margin-top:0;margin-bottom:1.56rem;" data-reactid="2"><a style="box-shadow:none;text-decoration:none;color:inherit;" href="/" data-reactid="3">Tinkering with Code.</a></h3><div data-reactid="4"><!-- react-empty: 5 --><h1 data-reactid="6">Elixir - Phoenix: Simple Authentication</h1><p style="font-size:0.83255rem;line-height:1.56rem;display:block;margin-bottom:1.56rem;margin-top:-1.56rem;" data-reactid="7">January 02, 2016</p><div data-reactid="8"><p>A simple Phoenix authentication flow for an JSON api. Using <a href="https://jwt.io/">JSON Web Tokens</a> via <a href="https://github.com/bryanjos/joken">Joken</a> and <a href="https://github.com/sajmoon/mellon">Mellon</a> for access controller.</p>
<h2>The basics.</h2>
<p>Let’s start from scratch. Create a new Phoenix Application. Read the <a href="http://www.phoenixframework.org/docs/up-and-running">Phoenix guide</a> to get started.</p>
<div class="gatsby-highlight">
      <pre class="language-sh"><code>$ mix phoenix.new --no-brunch app_name
$ cd app_name
$ mix ecto.setup</code></pre>
      </div>
<h2>Create a user model</h2>
<p>We will use a generator now and remove most of the code, but obviously you don’t have to.</p>
<div class="gatsby-highlight">
      <pre class="language-sh"><code>$ mix phoenix.gen.json User users email:string password_hash:string</code></pre>
      </div>
<p>We will want the emails to be unique so modify the migration file to include the following that will generate a index of all emails for us.</p>
<div class="gatsby-highlight">
      <pre class="language-none"><code>create unique_index(:users, [:email])</code></pre>
      </div>
<p>We need to modify the routes, so let’s do that. We start by adding all possible CRUD routes in <code>web/routes.ex</code>.</p>
<div class="gatsby-highlight">
      <pre class="language-none"><code>pipeline :api do
  plug :accepts, ["json"]
end

scope "/api/" do
  pipe_through :api
  resources "/users", UserController
end</code></pre>
      </div>
<p>Then fix the database.</p>
<div class="gatsby-highlight">
      <pre class="language-none"><code>$ mix ecto.migrate</code></pre>
      </div>
<p>We will not use the UserController but my memory is always messing with me and I need both the tests and controller to remember stuff.</p>
<h2>Registrate new users</h2>
<p>New users will <code>POST</code> to <code>/auth/</code> all data needed and a user will be created.</p>
<p>The route will be:</p>
<div class="gatsby-highlight">
      <pre class="language-none"><code>scope "/api/" do
  pipe_through :api
  resources "/users", UserController
  
  post "/auth", RegistrationController, :create
end</code></pre>
      </div>
<p>So we need a new controller called <code>RegistrationController</code> located  in <code>web/controllers/registration_controller.ex</code>. The tests for that controller will be in <code>tests/controller/registration_controller_test.exs</code>. Create them both. See the full code further down.</p>
<p>When a user registers s/he will send some json containing email and password. In the end we will store password_hash in the db. For the hashing of the password we use <a href="https://github.com/elixircnx/comeonin">comeonin</a>.</p>
<p>After we get the basics up and running, for example an endpoint that can take some post data and return a 200, we should modify the changeset method in the model to accept password and hide the password_hash.</p>
<p>Be sure to write tests for your code. To have your tests run as soon as you save a file you can use <a href="http://entrproject.org/">entr</a>.</p>
<div class="gatsby-highlight">
      <pre class="language-none"><code>while sleep 1; do ls -d lib/**/*.ex web/**/*.ex test/**/*.exs | entr│ mix test; done</code></pre>
      </div>
<h3>User Model</h3>
<p>We add a password field (virtual) to our model. That way we can pass it along from the user and convert it to a password_hash. We also change how the changeset works</p>
<div class="gatsby-highlight">
      <pre class="language-none"><code>schema "users" do
  field :email, :string
  field :password_hash, :string
  field :password, :string, virtual: true

  timestamps
end

@required_fields ~w(email password)

def changeset(model, params \\ :empty) do
  model
  |> cast(params, @required_fields, @optional_fields)
  |> unique_constraint(:email)
  |> validate_length(:password, min: 5)
  |> hash_password
end

defp hash_password(changeset) do
  if password = get_change(changeset, :password) do
    changeset
    |> put_change(:password_hash, hashpwsalt(password))
  else
    changeset
  end
end</code></pre>
      </div>
<p>We can test the password_hash in a model test:</p>
<div class="gatsby-highlight">
      <pre class="language-none"><code>test "password_hash value gets set to a hash" do
  changeset = User.changeset(%User{}, @valid_attrs)
  assert Comeonin.Bcrypt.checkpw(@valid_attrs.password, Ecto.Changeset.get_change(changeset, :password_hash))
end</code></pre>
      </div>
<p>You will obviously have to write more and better tests then this for a real system.</p>
<p>Also, remember to change the view of users so it returns no password, or password_hash.</p>
<p>The controller code and tests in full. You will see features omitted, such as validations of emails etc.</p>
<div class="gatsby-highlight">
      <pre class="language-none"><code>defmodule AppName.UserControllerTest do
  use AppName.ConnCase

  alias AppName.User
  @valid_attrs %{email: "some content", password: "validPassword"}
  @invalid_attrs %{}

  setup do
    conn = conn() |> put_req_header("accept", "application/json")
    {:ok, conn: conn}
  end

  test "creates and renders resource when data is valid", %{conn: conn} do
    conn = post conn, registration_path(conn, :create), user: @valid_attrs
    assert json_response(conn, 201)["data"]["id"]
    assert Repo.get_by(User, email: @valid_attrs.email)
  end

  test "does not create resource and renders errors when data is invalid", %{conn: conn} do
    conn = post conn, registration_path(conn, :create), user: @invalid_attrs
    assert json_response(conn, 422)["errors"] != %{}
  end

  test "Users should have unique emails", %{conn: conn} do
    post conn, registration_path(conn, :create), user: @valid_attrs
    conn = post conn, registration_path(conn, :create), user: @valid_attrs
    errors = json_response(conn, 422)["errors"]
    assert errors != %{}
    assert Map.has_key?(errors, "email")
    assert Map.get(errors, "email") == ["has already been taken"]
  end
end</code></pre>
      </div>
<p>And the controller itself:</p>
<div class="gatsby-highlight">
      <pre class="language-none"><code>defmodule AppName.RegistrationController do
  use AppName.Web, :controller

  alias AppName.User

  plug :scrub_params, "user" when action in [:create]

  def create(conn, %{"user" => user_params}) do
    changeset = User.changeset(%User{}, user_params)

    case Repo.insert(changeset) do
      {:ok, user} ->
        conn
        |> put_status(:created)
        |> render(AppName.UserView, "show.json", user: user)
      {:error, changeset} ->
        conn
        |> put_status(:unprocessable_entity)
        |> render(AppName.ChangesetView, "error.json", changeset: changeset)
    end
  end
end</code></pre>
      </div>
<p>Now we have something that allows us to create new users. Let´s enable Sign ins.</p>
<h2>Sign ins</h2>
<p>The user posts email and password, the server responds with 4xx if something went wrong. If the password matches the one stored in the database the server responds with 2xx and a Token.</p>
<p>Start by adding a new route</p>
<div class="gatsby-highlight">
      <pre class="language-none"><code>get "/auth/login", SessionController, :login</code></pre>
      </div>
<p>Create the controller and tests.</p>
<p>The tests will be something like this:</p>
<div class="gatsby-highlight">
      <pre class="language-none"><code>defmodule AppName.SessionControllerTest do
  use AppName.ConnCase

  alias AppName.User
  @valid_attrs %{email: "some content", password: "validPassword"}
  @invalid_attrs %{email: "non-existing-user@example.com", password: "no-password"}

  setup do
    changeset = User.changeset(%User{}, @valid_attrs)
    {:ok, user} = Repo.insert changeset
    token = User.generate_token(user)

    conn = conn() |> put_req_header("accept", "application/json")
    {:ok, conn: conn, user: user, token: token}
  end

  test "Cannot authenticate a non existing user", %{conn: conn} do
    conn = get conn, session_path(conn, :login), user: @invalid_attrs
    assert json_response(conn, 422)
  end

  test "Authenticate a valid user", %{conn: conn} do
    conn = get conn, session_path(conn, :login), user: @valid_attrs
    assert json_response(conn, 200)["data"]["token"] != nil
  end
end</code></pre>
      </div>
<p>The <code>generate_token</code> method is placed in the model to keep everything together, but could easily be placed in another file.</p>
<p>The controller for this looks </p>
<div class="gatsby-highlight">
      <pre class="language-none"><code>defmodule AppName.SessionController do
  use AppName.Web, :controller

  alias AppName.User

  def login(conn, %{"user" => user_params}) do
    if user = Repo.get_by(User, email: user_params["email"]) do

      token = User.generate_token(user)

      conn
      |> put_status(200)
      |> render(AppName.SessionView, "session.json", token: token)
    else
      conn
      |> put_status(:unprocessable_entity)
      |> render(AppName.SessionView, "error.json", message: "Nope")
    end
  end
end</code></pre>
      </div>
<p>We generate the token via a helper method in the model. It looks like this:</p>
<div class="gatsby-highlight">
      <pre class="language-none"><code>def generate_token(user) do
  %{user_id: user.id}
  |> token
  |> with_signer(hs256("secret-change-me"))
  |> sign
  |> get_compact
end</code></pre>
      </div>
<p>All the magic is <a href="https://github.com/bryanjos/joken">Joken</a>, and you should read more about the options for it.</p>
<p>In short is contains the data on the second line (e.g. user_id: 1) but is signed so anyone with the secret can validate that the user is actually signed in without having to look up a random string token in the database. We can pass values such as the user id but also role: “admin” etc. We can use this later to get the current user for each request. Do not put anything secret in the claims part of the token, since it is readable by everyone.</p>
<p>Alright. That is it! We have a way to register user and a way to authenticate a user.</p>
<p>Now we only need to ensure that a unauthenticated user does not have access to thing s/he should not. This is the fun part.</p>
<h3>Validating an authenticated user</h3>
<p>We will define some routes that are protected, for this example we will do a <code>/auth/validate</code> that responds with 200 if the user is authenticated. If not the response will be <code>401, Unauthticated</code>.</p>
<p>We will use Mellon to parse the header and provide an interface to validate the token. With mellon the token can be anything, it just hands the data to any function you define and you can handle the validations yourself.</p>
<p>Check out <a href="https://github.com/sajmoon/mellon">Mellon</a> for more information.</p>
<p>In your routes create a new pipeline and a route that is protected.</p>
<div class="gatsby-highlight">
      <pre class="language-none"><code>pipeline :authenticated do
  plug Mellon, validator: {AppName.Validation, :validate, []}, header: "api-token"
end

scope "/api/", AppName do
  pipe_through :api
  pipe_through :authenticated
  get "/auth/validate", SessionController, :validate
end</code></pre>
      </div>
<p>and the controller:</p>
<div class="gatsby-highlight">
      <pre class="language-none"><code>def validate(conn, _params) do
  conn
  |> put_status(200)
  |> render(AppName.UserView, "show.json", user: %User{email: "test"})
end</code></pre>
      </div>
<p>The content to the view is temporary, and should probably be the user object itself.</p>
<p>To test this (before you add the <code>pipe_through :authenticated</code>) you can write some tests such as these:</p>
<div class="gatsby-highlight">
      <pre class="language-none"><code>test "validate token", %{conn: conn, token: token} do
  conn = put_req_header(conn, "api-token", "Token: " <> token)
  conn = get conn, session_path(conn, :validate)
  assert json_response(conn, 200)
end

test "validate fails if invalid token", %{conn: conn} do
  conn = put_req_header(conn, "api-token", "Token: invalid-token")
  conn = get conn, session_path(conn, :validate)
  assert json_response(conn, 401)
end</code></pre>
      </div>
<p>You should see one or both fail.</p>
<p>The pipeline will pass all request through the Mellon Plug, which will call <code>AppName.Validation.validate/1</code> with the information needed to authenticate or reject the request.</p>
<p>The validate method gets the conn and token. We use a helper method in the model to verify the token, and then pass the claims (the information we put in the token: user_id: user.id) in the connection.
Mellon will assign it to the connection so we can use it in the controller. Which is good for more granular access controller.</p>
<p>The validator looks like this.</p>
<div class="gatsby-highlight">
      <pre class="language-none"><code>defmodule AppName.Validation do
  import Joken
  alias AppName.User

  def validate({conn, token}) do
    User.verify_token(token)
    |> handle(conn)
  end

  defp handle(%{error: nil, claims: claims}, conn) do
    {:ok, claims, conn}
  end
  defp handle(%{error: error}, conn) do
    {:error, [], conn}
  end
end</code></pre>
      </div>
<h2>Conclusion</h2>
<p>That it! We have a way to create users, authenticate users, and validate that the user is signed in with a valid token.</p>
<p>To do this we use <a href="https://github.com/sajmoon/mellon">Mellon</a> to parse the headers, <a href="https://github.com/bryanjos/joken">Joken</a> to create the token, and <a href="https://github.com/elixircnx/comeonin">comeonin</a> to encrypt the password stored in the database.</p></div><hr style="margin-bottom:1.56rem;" data-reactid="9"/><div style="display:flex;margin-bottom:3.9rem;" data-reactid="10"><img src="/static/profile-pic.54c63ad5.jpg" alt="Simon Ström" style="margin-right:0.78rem;margin-bottom:0;width:3.12rem;height:3.12rem;" data-reactid="11"/><p data-reactid="12"><!-- react-text: 13 -->Written by <!-- /react-text --><strong data-reactid="14">Simon Ström</strong><!-- react-text: 15 --> as a way to remember. It&#x27;s a dev log of thinks I want to remember.<!-- /react-text --></p></div></div><span style="display:block;clear:both;" data-reactid="16"> </span></div></div><script>
  
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45217361-8', 'auto');
  </script></body></html>